{% extends "base.html.twig" %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/vendor/nouislider/distribute/nouislider.css') }}">

    <style>
        #recherche{
            margin-top: 50px;
        }
        .billet{
            /*border : 1px solid lightgrey;*/
            margin: 10px;
            padding: 15px;
            border-radius: 3px;
        }

        #slider{
            margin-bottom: 50px;
        }


        #modal1 {
            width : 90%;
            height : 90%;
        }

        .container_donut svg {
            width:100%;
            height:400px;
        }

        .melviz {
            width: 100%;
            height: 400px;
        }


    </style>

{% endblock %}


{% block body %}

    <section class="container large">

        <div class="row" id="recherche">

            <div class="col s5">

                <div class="row">
                    <form class="col s12">

                        <div class="input-field col s12">
                            <select multiple id="exo">
                                <option value="" disabled selected>Select an exoticism (2 max)</option>
                                {% for item in exo %}
                                    <option value="{{ item.id|e('html') }}">{{ item.title|e('html') }}</option>
                                {% endfor %}
                            </select>
                            <label>Exoticism (multiple choice)</label>
                        </div>

                        <div class="input-field col s12">
                            <select id="studio">
                                <option value="" disabled selected>Select a studio</option>
                                {% for item in studio %}
                                    <option value="{{ item.id|e('html') }}">{{ item.title|e('html') }}</option>
                                {% endfor %}
                            </select>
                            <label>Studio (1 choice)</label>
                        </div>
                    </form>
                </div>

                <div class="row col s12">
                    <div  id="slider"></div>
                </div>

                {#<article class="s12 col card">#}
                    {#<h2>Some stats</h2>#}

                    {#<div class="songsSelection"></div>#}
                    {#<div class="filmsSelection"></div>#}
                    {#<div class="performersSelection"></div>#}

                {#</article>#}

                <article class="s12 col">
                    <div class="center">
                        {{ form_start(selectionForm)}}
                        <button class="btn white red-text generate-viz" type="submit" formnovalidate>Générer une visualisation</button>
                        {{ form_end(selectionForm)}}
                    </div>
                </article>



            </div>

            <div class="col s7">
                <div class="s12 card" id="resultat"></div>
            </div>

        </div>

    </section>


{% endblock %}

{% block javascripts %}

    {{ parent() }}
    <script src="{{ asset('assets/vendor/wnumb/wNumb.js') }}"></script>
    <script src="{{ asset('assets/vendor/nouislider/distribute/nouislider.js') }}"></script>
    <script src="{{ asset('js/donut_simple.js') }}"></script>
    {#<script src="{{ asset('assets/vendor/d3-tip/index.js') }}"></script>#}
    {#<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>#}
    <script src="{{ asset('js/melviz.js') }}"></script>



    <script>

        $('.generate-viz').click(function(){
            alert('hello');
        });

        function changementFiltre(){

            _exo = $("#exo").val();
            _studio = $('#studio').val();

            if (_exo == "") {
                _exo = "all";
            }
            if (_studio == null) {
                _studio = "all";
            }

            console.log(_studio);
            slider_values = slider.noUiSlider.get();
            min_slider = slider_values[0];
            max_slider = slider_values[1];


            var url = '{{ path("search_exoticism", {'exoticisms': 'varExo', 'studio': 'varStudio', 'begin': 'varBegin', 'end': 'varEnd'}) }}';
            url = url.replace("varExo", _exo);
            url = url.replace("varStudio", _studio);
            url = url.replace("varBegin", min_slider);
            url = url.replace("varEnd", max_slider);
            d3.json(url , function(error, data) {
                afficherResult(data);
            });

        }

        $("select").change(function(){
            changementFiltre();
        });



        function afficherResult(n) {

            billets = "";

            console.log(n);

            var i;

            for (var i=0; i<n.length; i++) {
                console.log("test");

                billets += "<div class='billet card'><div><a href='/number/"+n[i].numberId+"'><h2>"+n[i].title+"</h2></a><a href='/film/id/"+n[i].film.id+" '><h3>"+n[i].film.title+"</h3></a></div></div>";
            }

            infos = "<div>Number of results : "+i+" (only the first 20 numbers are displayed)</div>";
            $("#resultat").html(infos+billets);

        }



    </script>



    <script>



        //////////////////////////////////////////////////////////////////////////////
        //Slider
        //////////////////////////////////////////////////////////////////////////////

        var slider = document.getElementById('slider');
        var _min = 1850;
        var _max = 2000;

        noUiSlider.create(slider, {
            start: [1880, 1980],
            connect: true,
            range: {
                'min': _min,
                'max': _max
            },
            format: wNumb({
                decimals: 0
            }),
            tooltips: true,
            step: 1

        });

        slider_values = [];
        var min_slider ='';
        var max_slider ='';

        slider.noUiSlider.on('end', function(){
            slider_values = slider.noUiSlider.get();
            min_slider = slider_values[0];
            max_slider = slider_values[1];
            console.log(max_slider);
            changementFiltre();
        });

        //////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////

        $(document).ready(function() {
            Materialize.updateTextFields();
            $('select').material_select();

        });

    </script>

{% endblock %}
